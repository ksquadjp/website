---
import Post from "../../layouts/Post.astro";
import { getPosts, getPostDetail } from "../../library/microcms";
import { remark } from "remark";
import remarkHtml from "remark-html";

export const getStaticPaths = async () => {
  const response = await getPosts("blogs", { fields: ["id"] });
  return response.contents.map((blog) => ({
    params: {
      slug: blog.id,
    },
  }));
};

const processContentToHTML = (content) => {
  const processedContent = remark().use(remarkHtml).process(content);
  return processedContent;
};

const { slug } = Astro.params;
const blog = await getPostDetail(slug, "blogs");
const processedBlog = processContentToHTML(blog.content);
---

<Post {...blog}>
  <div set:html={processedBlog} />
</Post>
